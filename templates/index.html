<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Channel Scraper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-full bg-gray-50 font-sans">
    <div id="app" class="min-h-full">
        <!-- Navigation -->
        <nav class="gradient-bg shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-8 w-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h1 class="text-xl font-bold text-white">YouTube Scraper</h1>
                            <p class="text-xs text-purple-200">Influencer Discovery Tool</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="scraper-status" class="flex items-center text-sm text-white">
                            <span class="w-2 h-2 rounded-full bg-green-400 mr-2"></span>
                            <span>Ready</span>
                        </div>
                        <button onclick="showScrapeModal()" id="scrape-btn" 
                            class="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 transition-all flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Run Scraper
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Tab Navigation -->
        <div class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex space-x-8" aria-label="Tabs">
                    <button onclick="switchTab('dashboard')" id="tab-dashboard" 
                        class="tab-btn border-purple-500 text-purple-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Dashboard
                    </button>
                    <button onclick="switchTab('channels')" id="tab-channels" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Channels
                    </button>
                    <button onclick="switchTab('queries')" id="tab-queries" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Search Queries
                    </button>
                    <button onclick="switchTab('history')" id="tab-history" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        History
                    </button>
                    <button onclick="switchTab('campaigns')" id="tab-campaigns" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        ğŸ“§ Campaigns
                    </button>
                    <button onclick="switchTab('emails')" id="tab-emails" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        âš™ï¸ Email Accounts
                    </button>
                    <button onclick="switchTab('mailing')" id="tab-mailing" 
                        class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        ğŸ“‹ Mailing List
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Tab -->
            <div id="content-dashboard" class="tab-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover transition-all">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Total Channels</p>
                                <p id="stat-channels" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover transition-all">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Total Subscribers</p>
                                <p id="stat-subscribers" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover transition-all">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Active Queries</p>
                                <p id="stat-queries" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover transition-all">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500">Last Scrape</p>
                                <p id="stat-last-scrape" class="text-sm font-bold text-gray-900">Never</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Country Distribution -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Channels by Country</h3>
                        <div id="country-chart" class="space-y-3"></div>
                    </div>
                    <!-- Language Distribution -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Channels by Language</h3>
                        <div id="language-chart" class="space-y-3"></div>
                    </div>
                </div>
            </div>

            <!-- Channels Tab -->
            <div id="content-channels" class="tab-content hidden">
                <!-- Search and Filters -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        <!-- Search -->
                        <div class="relative">
                            <label class="block text-xs font-medium text-gray-500 mb-1">Search</label>
                            <input type="text" id="channel-search" placeholder="Search channels..." 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
                                oninput="debounce(loadChannels, 300)()">
                            <svg class="absolute left-3 top-7 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        
                        <!-- Country Filter -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Country</label>
                            <select id="filter-country" onchange="loadChannels()" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                                <option value="">All Countries</option>
                            </select>
                        </div>
                        
                        <!-- Language Filter -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Language</label>
                            <select id="filter-language" onchange="loadChannels()" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                                <option value="">All Languages</option>
                            </select>
                        </div>
                        
                        <!-- Subscribers Filter -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Subscribers</label>
                            <select id="filter-subscribers" onchange="loadChannels()" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                                <option value="0-0">All</option>
                            </select>
                        </div>
                        
                        <!-- Export Button -->
                        <div class="flex items-end">
                            <button onclick="exportChannels()" 
                                class="w-full bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-all flex items-center justify-center text-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                Export CSV
                            </button>
                        </div>
                    </div>
                    
                    <!-- Clear Filters -->
                    <div class="flex justify-between items-center mt-3 pt-3 border-t">
                        <span id="filter-count" class="text-sm text-gray-500">Showing 0 channels</span>
                        <button onclick="clearFilters()" class="text-sm text-purple-600 hover:text-purple-800">
                            Clear all filters
                        </button>
                    </div>
                </div>

                <!-- Channel Cards -->
                <div id="channels-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Channels will be loaded here -->
                </div>

                <!-- Pagination -->
                <div id="pagination" class="flex justify-center items-center mt-8 space-x-2">
                    <!-- Pagination buttons -->
                </div>
            </div>

            <!-- Queries Tab -->
            <div id="content-queries" class="tab-content hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-xl font-semibold text-gray-900">Search Queries</h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="showBulkQueryModal()" 
                            class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-all flex items-center text-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            Bulk Upload
                        </button>
                        <button onclick="resetQueries()" 
                            class="bg-yellow-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-yellow-600 transition-all flex items-center text-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Reset to Defaults
                        </button>
                        <button onclick="clearAllQueries()" 
                            class="bg-red-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-all flex items-center text-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Clear All
                        </button>
                        <button onclick="showAddQueryModal()" 
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all flex items-center text-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Single
                        </button>
                    </div>
                </div>
                
                <!-- Tips for better queries -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-medium text-blue-900 mb-2">Tips for Finding Real Creators:</h3>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>â€¢ Use phrases like "how I made", "my journey", "my story" to find personal content</li>
                        <li>â€¢ Add "2024" or "2025" to get active creators</li>
                        <li>â€¢ Try niche-specific terms: "dropshipping journey", "affiliate income report"</li>
                        <li>â€¢ Avoid brand names like "Shopify tutorial" - try "my Shopify store" instead</li>
                    </ul>
                </div>

                <div id="queries-list" class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <!-- Queries will be loaded here -->
                </div>
            </div>

            <!-- History Tab -->
            <div id="content-history" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Scrape History</h2>
                <div id="history-list" class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <!-- History will be loaded here -->
                </div>
            </div>

            <!-- Campaigns Tab -->
            <div id="content-campaigns" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Email Campaigns & Outreach</h2>
                    <button onclick="showCampaignModal()" 
                        class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        New Campaign
                    </button>
                </div>
                
                <!-- Auto-Mode Banner -->
                <div id="auto-mode-banner" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl p-4 mb-6 flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-white rounded-full animate-pulse mr-3"></div>
                        <div>
                            <p class="font-semibold">Auto-Negotiation Mode: ACTIVE</p>
                            <p class="text-sm text-green-100">Checking inbox every 5 minutes â€¢ AI auto-responds to creators</p>
                        </div>
                    </div>
                    <button onclick="runAutoNegotiatorNow()" 
                        class="bg-white text-green-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-50 transition-all">
                        Check Now
                    </button>
                </div>
                
                <!-- Outreach Stats -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-sm text-gray-500">Total Outreach</p>
                        <p class="text-2xl font-bold text-purple-600" id="outreach-total">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-sm text-gray-500">Drafts</p>
                        <p class="text-2xl font-bold text-gray-600" id="outreach-drafts">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-sm text-gray-500">Sent</p>
                        <p class="text-2xl font-bold text-blue-600" id="outreach-sent">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-sm text-gray-500">Replied</p>
                        <p class="text-2xl font-bold text-green-600" id="outreach-replied">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-sm text-gray-500">Deals Closed</p>
                        <p class="text-2xl font-bold text-yellow-600" id="outreach-deals">0</p>
                    </div>
                </div>
                
                <!-- Campaigns List -->
                <div id="campaigns-list" class="space-y-4">
                    <!-- Campaigns will be loaded here -->
                </div>
            </div>

            <!-- Email Accounts Tab -->
            <div id="content-emails" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Email Accounts (SMTP)</h2>
                    <div class="flex space-x-2">
                        <button onclick="showBulkEmailModal()" 
                            class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-all flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            Bulk Add
                        </button>
                        <button onclick="showEmailAccountModal()" 
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Account
                        </button>
                    </div>
                </div>
                
                <!-- Gmail Setup Info -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-medium text-blue-900 mb-2">ğŸ“§ Gmail App Password Setup:</h3>
                    <ol class="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                        <li>Go to <a href="https://myaccount.google.com/security" target="_blank" class="underline">Google Account Security</a></li>
                        <li>Enable 2-Step Verification if not already enabled</li>
                        <li>Go to "App passwords" and generate a new password</li>
                        <li>Use that 16-character password here (not your regular Gmail password)</li>
                    </ol>
                </div>
                
                <!-- Email Accounts List -->
                <div id="email-accounts-list" class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <!-- Email accounts will be loaded here -->
                </div>
            </div>
            
            <!-- Mailing List Tab -->
            <div id="content-mailing" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">Mailing List</h2>
                        <p class="text-sm text-gray-500 mt-1">Add creator emails, select a campaign, and send bulk outreach</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="clearMailingList()" 
                            class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-medium hover:bg-red-200 transition-all">
                            Clear All
                        </button>
                        <button onclick="showAddContactModal()" 
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Contacts
                        </button>
                    </div>
                </div>
                
                <!-- Mailing List Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="text-2xl font-bold text-gray-900" id="ml-stat-total">0</div>
                        <div class="text-sm text-gray-500">Total Contacts</div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="text-2xl font-bold text-yellow-600" id="ml-stat-pending">0</div>
                        <div class="text-sm text-gray-500">Pending</div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="text-2xl font-bold text-green-600" id="ml-stat-sent">0</div>
                        <div class="text-sm text-gray-500">Sent</div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="text-2xl font-bold text-blue-600" id="ml-stat-replied">0</div>
                        <div class="text-sm text-gray-500">Replied</div>
                    </div>
                </div>
                
                <!-- Send All Section -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 mb-6 border border-purple-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸš€ Bulk Send Outreach</h3>
                    <div class="flex flex-wrap items-end gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Select Campaign</label>
                            <select id="ml-campaign-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">-- Select a Campaign --</option>
                            </select>
                        </div>
                        <button onclick="sendToAllPending()" 
                            class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            Send to All Pending
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">AI will generate personalized emails for each contact based on the campaign brief</p>
                </div>
                
                <!-- Mailing List Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Channel</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mailing-list-body" class="bg-white divide-y divide-gray-200">
                            <!-- Contacts will be loaded here -->
                        </tbody>
                    </table>
                    <div id="mailing-list-empty" class="hidden p-12 text-center">
                        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No contacts yet</h3>
                        <p class="text-gray-500 mb-4">Add creator emails to start your outreach campaign</p>
                        <button onclick="showAddContactModal()" 
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all">
                            Add Contacts
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Run Scraper Modal -->
    <div id="scrape-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Run YouTube Scraper</h3>
            
            <div class="space-y-5">
                <!-- Clear Previous Option -->
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <input type="checkbox" id="clear-previous" 
                            class="mt-1 h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                        <div class="ml-3">
                            <label for="clear-previous" class="text-sm font-medium text-gray-900">
                                Clear previous channels
                            </label>
                            <p class="text-xs text-gray-500 mt-1">
                                Remove all existing channels and only show newly scraped results
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Region/Country Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Countries/Regions to Search
                        <span class="text-xs text-gray-500 ml-1">(Select multiple)</span>
                    </label>
                    <div class="grid grid-cols-3 sm:grid-cols-5 gap-2 max-h-48 overflow-y-auto p-2 border rounded-lg bg-gray-50">
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="US" class="scrape-country h-4 w-4 text-purple-600 rounded" checked>
                            <span>ğŸ‡ºğŸ‡¸ USA</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="IN" class="scrape-country h-4 w-4 text-purple-600 rounded" checked>
                            <span>ğŸ‡®ğŸ‡³ India</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="PE" class="scrape-country h-4 w-4 text-purple-600 rounded" checked>
                            <span>ğŸ‡µğŸ‡ª Peru</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="GB" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¬ğŸ‡§ UK</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="CA" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¨ğŸ‡¦ Canada</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="AU" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¦ğŸ‡º Australia</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="DE" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡©ğŸ‡ª Germany</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="FR" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡«ğŸ‡· France</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="BR" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡§ğŸ‡· Brazil</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="MX" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡²ğŸ‡½ Mexico</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="ES" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡ªğŸ‡¸ Spain</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="IT" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡®ğŸ‡¹ Italy</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="NL" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡³ğŸ‡± Netherlands</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="PL" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡µğŸ‡± Poland</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="AR" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¦ğŸ‡· Argentina</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="CO" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¨ğŸ‡´ Colombia</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="CL" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¨ğŸ‡± Chile</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="JP" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¯ğŸ‡µ Japan</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="KR" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡°ğŸ‡· S. Korea</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="ID" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡®ğŸ‡© Indonesia</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="PH" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡µğŸ‡­ Philippines</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="TH" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¹ğŸ‡­ Thailand</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="VN" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡»ğŸ‡³ Vietnam</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="MY" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡²ğŸ‡¾ Malaysia</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="SG" class="scrape-country h-4 w-4 text-purple-600 rounded">
                            <span>ğŸ‡¸ğŸ‡¬ Singapore</span>
                        </label>
                    </div>
                    <div class="flex space-x-2 mt-2">
                        <button onclick="selectAllCountries()" class="text-xs text-purple-600 hover:underline">Select All</button>
                        <span class="text-gray-300">|</span>
                        <button onclick="deselectAllCountries()" class="text-xs text-purple-600 hover:underline">Deselect All</button>
                    </div>
                </div>
                
                <!-- Language Preference -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Language Preference
                        <span class="text-xs text-gray-500 ml-1">(Channels in these languages)</span>
                    </label>
                    <div class="grid grid-cols-3 sm:grid-cols-4 gap-2 p-2 border rounded-lg bg-gray-50">
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="english" class="scrape-language h-4 w-4 text-purple-600 rounded" checked>
                            <span>English</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="hindi" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>Hindi</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="spanish" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>Spanish</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="portuguese" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>Portuguese</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="french" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>French</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="german" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>German</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="japanese" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>Japanese</span>
                        </label>
                        <label class="flex items-center space-x-2 text-sm cursor-pointer hover:bg-white p-1 rounded">
                            <input type="checkbox" value="korean" class="scrape-language h-4 w-4 text-purple-600 rounded">
                            <span>Korean</span>
                        </label>
                    </div>
                </div>
                
                <!-- Minimum Subscribers -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Minimum Subscribers
                    </label>
                    <select id="scrape-min-subs" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                        <option value="0">No minimum</option>
                        <option value="100">100+ subscribers</option>
                        <option value="1000" selected>1,000+ subscribers</option>
                        <option value="5000">5,000+ subscribers</option>
                        <option value="10000">10,000+ subscribers</option>
                        <option value="50000">50,000+ subscribers</option>
                        <option value="100000">100,000+ subscribers</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                <button type="button" onclick="hideScrapeModal()" 
                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all">
                    Cancel
                </button>
                <button onclick="triggerScrape()" id="confirm-scrape-btn"
                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Start Scraping
                </button>
            </div>
        </div>
    </div>

    <!-- Add Query Modal -->
    <div id="query-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add Search Query</h3>
            <form id="query-form" onsubmit="saveQuery(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Search Query</label>
                        <input type="text" id="query-input" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="e.g., how I made money with facebook ads">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Max Results</label>
                            <input type="number" id="max-results-input" value="25" min="1" max="50"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                            <select id="region-input" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="US">United States</option>
                                <option value="IN">India</option>
                                <option value="PE">Peru</option>
                                <option value="GB">United Kingdom</option>
                                <option value="CA">Canada</option>
                                <option value="AU">Australia</option>
                                <option value="DE">Germany</option>
                                <option value="BR">Brazil</option>
                                <option value="MX">Mexico</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="hideQueryModal()" 
                        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all">
                        Cancel
                    </button>
                    <button type="submit" 
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all">
                        Save Query
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Query Modal -->
    <div id="bulk-query-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Bulk Upload Queries</h3>
            <p class="text-sm text-gray-500 mb-4">Paste multiple search queries, one per line</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Search Queries (one per line)</label>
                    <textarea id="bulk-queries-input" rows="12"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm"
                        placeholder="how I made money with facebook ads
my dropshipping journey 2024
how I grew my ecommerce store
facebook ads case study real results
my first $10k month online
side hustle income report
affiliate marketing for beginners
tiktok ads strategy that works
amazon fba journey 2024
print on demand success story"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Max Results per Query</label>
                        <input type="number" id="bulk-max-results" value="25" min="1" max="50"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Default Region</label>
                        <select id="bulk-region" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="US">United States</option>
                            <option value="IN">India</option>
                            <option value="PE">Peru</option>
                            <option value="GB">United Kingdom</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="bulk-clear-existing" 
                        class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                    <label for="bulk-clear-existing" class="ml-2 text-sm text-gray-700">
                        Replace all existing queries (clear first)
                    </label>
                </div>
                
                <!-- Example queries -->
                <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-xs font-medium text-gray-600 mb-2">Example creator-focused queries:</p>
                    <div class="flex flex-wrap gap-1">
                        <button onclick="addExampleQuery('how I made $10k dropshipping')" class="text-xs bg-white px-2 py-1 rounded border hover:bg-purple-50">how I made $10k dropshipping</button>
                        <button onclick="addExampleQuery('my journey to 100k subscribers')" class="text-xs bg-white px-2 py-1 rounded border hover:bg-purple-50">my journey to 100k subscribers</button>
                        <button onclick="addExampleQuery('quit my job for youtube')" class="text-xs bg-white px-2 py-1 rounded border hover:bg-purple-50">quit my job for youtube</button>
                        <button onclick="addExampleQuery('facebook ads real results 2024')" class="text-xs bg-white px-2 py-1 rounded border hover:bg-purple-50">facebook ads real results 2024</button>
                        <button onclick="addExampleQuery('passive income ideas that work')" class="text-xs bg-white px-2 py-1 rounded border hover:bg-purple-50">passive income ideas that work</button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center mt-6 pt-4 border-t">
                <span id="bulk-query-count" class="text-sm text-gray-500">0 queries</span>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideBulkQueryModal()" 
                        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all">
                        Cancel
                    </button>
                    <button onclick="saveBulkQueries()" 
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
                        Upload All Queries
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div id="campaign-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Create New Campaign</h3>
            <form id="campaign-form" onsubmit="saveCampaign(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Campaign Name*</label>
                        <input type="text" id="campaign-name" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="e.g., Summer Product Launch">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Brief / Message for Creators</label>
                        <textarea id="campaign-brief" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="Describe your campaign, product, or what you're looking for..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Topic / Product</label>
                        <input type="text" id="campaign-topic"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="e.g., Fitness App, E-commerce Store">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Budget Min ($)</label>
                            <input type="number" id="campaign-budget-min" value="100"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Budget Max ($)</label>
                            <input type="number" id="campaign-budget-max" value="500"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                    
                    <!-- Max Offer Slider -->
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ğŸ¯ Max Offer for Negotiation: <span id="max-offer-display" class="text-green-600 font-bold">$500</span>
                        </label>
                        <input type="range" id="campaign-max-offer" 
                            min="50" max="10000" step="50" value="500"
                            oninput="document.getElementById('max-offer-display').textContent = '$' + this.value"
                            class="w-full h-2 bg-green-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>$50</span>
                            <span>$2,500</span>
                            <span>$5,000</span>
                            <span>$7,500</span>
                            <span>$10,000</span>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">
                            âš¡ AI will increase offers by <strong>$50</strong> each negotiation round until this max is reached.
                            <br>If creator asks more than this, AI will politely decline.
                        </p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Requirements</label>
                        <textarea id="campaign-requirements" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="Any specific requirements for content..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deadline</label>
                        <input type="text" id="campaign-deadline"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="e.g., March 2026, Flexible">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                    <button type="button" onclick="hideCampaignModal()" 
                        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button type="submit" 
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Create Campaign</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Email Account Modal -->
    <div id="email-account-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add Email Account</h3>
            
            <!-- Provider Selection -->
            <div class="flex space-x-2 mb-4">
                <button type="button" onclick="selectEmailProvider('gmail')" id="provider-gmail"
                    class="flex-1 py-2 px-4 rounded-lg border-2 border-purple-500 bg-purple-50 text-purple-700 font-medium">
                    Gmail
                </button>
                <button type="button" onclick="selectEmailProvider('sendgrid')" id="provider-sendgrid"
                    class="flex-1 py-2 px-4 rounded-lg border-2 border-gray-200 text-gray-600 font-medium hover:border-gray-300">
                    SendGrid
                </button>
                <button type="button" onclick="selectEmailProvider('custom')" id="provider-custom"
                    class="flex-1 py-2 px-4 rounded-lg border-2 border-gray-200 text-gray-600 font-medium hover:border-gray-300">
                    Custom SMTP
                </button>
            </div>
            
            <form id="email-account-form" onsubmit="saveEmailAccount(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address*</label>
                        <input type="email" id="email-address" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="your@company.com">
                    </div>
                    
                    <!-- Gmail Instructions -->
                    <div id="gmail-instructions" class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm">
                        <p class="font-medium text-yellow-800 mb-1">For Gmail/Google Workspace:</p>
                        <p class="text-yellow-700">Use App Password (not regular password). If unavailable, use SendGrid instead.</p>
                    </div>
                    
                    <!-- SendGrid Instructions -->
                    <div id="sendgrid-instructions" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                        <p class="font-medium text-blue-800 mb-1">SendGrid Setup:</p>
                        <ol class="text-blue-700 list-decimal list-inside space-y-1">
                            <li>Sign up at <a href="https://sendgrid.com" target="_blank" class="underline">sendgrid.com</a> (free)</li>
                            <li>Go to Settings â†’ API Keys â†’ Create API Key</li>
                            <li>Paste the API key below as password</li>
                        </ol>
                    </div>
                    
                    <!-- Custom SMTP Fields -->
                    <div id="custom-smtp-fields" class="hidden space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">SMTP Host*</label>
                                <input type="text" id="smtp-host"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                    placeholder="smtp.example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">SMTP Port*</label>
                                <input type="number" id="smtp-port" value="587"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">SMTP Username</label>
                            <input type="text" id="smtp-user"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="Leave empty to use email address">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" id="password-label">Password / API Key*</label>
                        <input type="password" id="email-password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="App Password or API Key">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Display Name</label>
                        <input type="text" id="email-display-name"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="Your Name or Company">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Daily Send Limit</label>
                        <input type="number" id="email-daily-limit" value="100"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="skip-test" class="h-4 w-4 text-purple-600 rounded">
                        <label for="skip-test" class="ml-2 text-sm text-gray-600">
                            Skip connection test (add account without verifying)
                        </label>
                    </div>
                </div>
                
                <input type="hidden" id="email-provider" value="gmail">
                
                <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                    <button type="button" onclick="hideEmailAccountModal()" 
                        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button type="button" onclick="saveEmailAccount(event)"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Add Account</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Email Accounts Modal -->
    <div id="bulk-email-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Bulk Add Email Accounts</h3>
            <p class="text-sm text-gray-500 mb-4">Add multiple email accounts at once (one per line)</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Format: email,password</label>
                    <textarea id="bulk-emails-input" rows="8"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                        placeholder="account1@gmail.com,apppassword1
account2@gmail.com,apppassword2
account3@gmail.com,apppassword3"></textarea>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800">
                    <strong>Note:</strong> Each account will be tested before adding. Failed connections will be skipped.
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                <button type="button" onclick="hideBulkEmailModal()" 
                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                <button onclick="saveBulkEmails()" 
                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Add All Accounts</button>
            </div>
        </div>
    </div>

    <!-- Add Contact Modal (Mailing List) -->
    <div id="add-contact-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Add Contacts to Mailing List</h3>
            <p class="text-sm text-gray-500 mb-4">Add creator emails for bulk outreach</p>
            
            <div class="space-y-4">
                <!-- Single Contact -->
                <div class="border-b pb-4">
                    <h4 class="font-medium text-gray-700 mb-3">Add Single Contact</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Name*</label>
                            <input type="text" id="contact-name" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="Creator name">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Email*</label>
                            <input type="email" id="contact-email" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="creator@email.com">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm text-gray-600 mb-1">Notes (optional)</label>
                        <input type="text" id="contact-notes" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            placeholder="e.g., Tech reviewer, 50K subs">
                    </div>
                    <button onclick="addSingleContact()" 
                        class="mt-3 bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-all text-sm">
                        Add Contact
                    </button>
                </div>
                
                <!-- Bulk Add -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-3">Or Paste Multiple Contacts</h4>
                    <p class="text-xs text-gray-500 mb-2">Format: Name, Email (one per line)</p>
                    <textarea id="bulk-contacts-input" rows="6"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                        placeholder="John Doe, john@email.com
Jane Smith, jane@email.com
Tech Creator, tech@youtube.com"></textarea>
                    <button onclick="addBulkContacts()" 
                        class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-all text-sm">
                        Add All Contacts
                    </button>
                </div>
            </div>
            
            <div class="flex justify-end mt-6 pt-4 border-t">
                <button type="button" onclick="hideAddContactModal()" 
                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Creators to Campaign Modal -->
    <div id="add-creators-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-1">Add Creators to Campaign</h3>
            <p class="text-sm text-gray-500 mb-4">Campaign: <strong id="add-creators-campaign-name"></strong></p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Creator Contacts</label>
                    <p class="text-xs text-gray-500 mb-2">Format: Name, Email (one per line)</p>
                    <textarea id="campaign-creators-input" rows="8"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                        placeholder="John Tech Reviewer, john@techreviews.com
Sarah Gaming, sarah@gamingchannel.com
Mike Fitness, mike@fitnessvids.com
emma.lifestyle@gmail.com"></textarea>
                    <p class="text-xs text-gray-400 mt-1">You can also just paste emails (one per line)</p>
                </div>
                
                <div class="bg-purple-50 border border-purple-100 rounded-lg p-3">
                    <p class="text-sm text-purple-800">
                        <strong>Tip:</strong> After adding creators, click "Start Campaign" to send AI-generated personalized emails to all of them.
                    </p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                <button type="button" onclick="hideAddCreatorsModal()" 
                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                <button onclick="addCreatorsToCampaign()" 
                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium">Add Creators</button>
            </div>
        </div>
    </div>

    <!-- Campaign Detail Modal (Conversations) -->
    <div id="campaign-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl w-full max-w-4xl mx-4 my-8 fade-in max-h-[90vh] flex flex-col">
            <div class="p-6 border-b">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900" id="campaign-detail-name">Campaign</h3>
                        <p class="text-sm text-gray-500 mt-1" id="campaign-detail-brief">Brief</p>
                    </div>
                    <button onclick="hideCampaignDetailModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto flex-1">
                <h4 class="font-medium text-gray-900 mb-4">Email Conversations</h4>
                <div id="campaign-outreach-list">
                    <!-- Outreach emails will be loaded here -->
                </div>
            </div>
            
            <div class="p-4 border-t bg-gray-50 rounded-b-xl">
                <button onclick="hideCampaignDetailModal()" 
                    class="w-full px-4 py-2 text-gray-700 bg-white border rounded-lg hover:bg-gray-100">Close</button>
            </div>
        </div>
    </div>

    <!-- Reply Input Modal -->
    <div id="reply-input-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Log Creator's Reply</h3>
            <p class="text-sm text-gray-500 mb-4">Paste the reply you received from the creator</p>
            
            <textarea id="creator-reply-text" rows="6"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                placeholder="Paste the creator's email reply here..."></textarea>
            
            <div class="flex justify-end space-x-3 mt-4">
                <button onclick="hideReplyInputModal()" 
                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                <button onclick="saveCreatorReply()" 
                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">Save Reply</button>
            </div>
        </div>
    </div>

    <!-- Outreach Modal (for sending emails to creators) -->
    <div id="outreach-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4 my-8 fade-in">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Send Outreach Email</h3>
            <div class="space-y-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm text-gray-600">Sending to: <strong id="outreach-creator-name"></strong></p>
                    <p class="text-sm text-gray-500" id="outreach-creator-subs"></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Creator's Email*</label>
                    <input type="email" id="outreach-recipient-email" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                        placeholder="creator@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Select Campaign*</label>
                    <select id="outreach-campaign" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">-- Select Campaign --</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Send From Account*</label>
                    <select id="outreach-email-account" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">-- Select Email Account --</option>
                    </select>
                </div>
                <div id="generated-email-preview" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Preview</label>
                    <div class="border rounded-lg p-4 bg-gray-50">
                        <p class="font-medium text-gray-900" id="preview-subject"></p>
                        <hr class="my-2">
                        <p class="text-sm text-gray-700 whitespace-pre-wrap" id="preview-body"></p>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-6 pt-4 border-t">
                <button onclick="generateOutreachPreview()" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Generate with AI
                </button>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideOutreachModal()" 
                        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button onclick="sendOutreachEmail()" id="send-outreach-btn"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                        Send Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg hidden fade-in">
        <span id="toast-message">Message</span>
    </div>

    <script>
        // State
        let currentPage = 0;
        const pageSize = 12;
        let debounceTimer;
        let filterOptions = null;

        // Utility functions
        function debounce(func, wait) {
            return function(...args) {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => func.apply(this, args), wait);
            };
        }
        
        // Load filter options
        async function loadFilterOptions() {
            try {
                const response = await fetch('/api/filters');
                filterOptions = await response.json();
                
                // Populate country dropdown
                const countrySelect = document.getElementById('filter-country');
                countrySelect.innerHTML = '<option value="">All Countries</option>' +
                    filterOptions.countries.map(c => 
                        `<option value="${c.code}">${c.name}</option>`
                    ).join('');
                
                // Populate language dropdown
                const languageSelect = document.getElementById('filter-language');
                languageSelect.innerHTML = '<option value="">All Languages</option>' +
                    filterOptions.languages.map(l => 
                        `<option value="${l}">${l.charAt(0).toUpperCase() + l.slice(1)}</option>`
                    ).join('');
                
                // Populate subscriber dropdown
                const subsSelect = document.getElementById('filter-subscribers');
                subsSelect.innerHTML = filterOptions.subscriber_ranges.map(r => 
                    `<option value="${r.min}-${r.max}">${r.label}</option>`
                ).join('');
            } catch (error) {
                console.error('Error loading filter options:', error);
            }
        }
        
        function getFilterParams() {
            const search = document.getElementById('channel-search')?.value || '';
            const country = document.getElementById('filter-country')?.value || '';
            const language = document.getElementById('filter-language')?.value || '';
            const subsValue = document.getElementById('filter-subscribers')?.value || '0-0';
            const [minSubs, maxSubs] = subsValue.split('-').map(Number);
            
            return { search, country, language, minSubs, maxSubs };
        }
        
        function clearFilters() {
            document.getElementById('channel-search').value = '';
            document.getElementById('filter-country').value = '';
            document.getElementById('filter-language').value = '';
            document.getElementById('filter-subscribers').value = '0-0';
            currentPage = 0;
            loadChannels();
        }
        
        // Scrape modal functions
        function showScrapeModal() {
            document.getElementById('scrape-modal').classList.remove('hidden');
            document.getElementById('scrape-modal').classList.add('flex');
        }
        
        function hideScrapeModal() {
            document.getElementById('scrape-modal').classList.add('hidden');
            document.getElementById('scrape-modal').classList.remove('flex');
            document.getElementById('clear-previous').checked = false;
        }
        
        function selectAllCountries() {
            document.querySelectorAll('.scrape-country').forEach(cb => cb.checked = true);
        }
        
        function deselectAllCountries() {
            document.querySelectorAll('.scrape-country').forEach(cb => cb.checked = false);
        }
        
        function getScrapeFilters() {
            const countries = Array.from(document.querySelectorAll('.scrape-country:checked')).map(cb => cb.value);
            const languages = Array.from(document.querySelectorAll('.scrape-language:checked')).map(cb => cb.value);
            const minSubs = parseInt(document.getElementById('scrape-min-subs').value) || 0;
            return { countries, languages, minSubs };
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Never';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            let bgColor = 'bg-green-600';
            if (type === 'error') bgColor = 'bg-red-600';
            else if (type === 'info') bgColor = 'bg-blue-600';
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg fade-in ${bgColor} text-white`;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById(`tab-${tabName}`).classList.add('border-purple-500', 'text-purple-600');
            document.getElementById(`tab-${tabName}`).classList.remove('border-transparent', 'text-gray-500');
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            // Load data for tab
            if (tabName === 'dashboard') loadStats();
            if (tabName === 'channels') loadChannels();
            if (tabName === 'queries') loadQueries();
            if (tabName === 'history') loadHistory();
        }

        // Dashboard
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                document.getElementById('stat-channels').textContent = formatNumber(stats.total_channels);
                document.getElementById('stat-subscribers').textContent = formatNumber(stats.total_subscribers);
                document.getElementById('stat-queries').textContent = stats.active_queries;
                document.getElementById('stat-last-scrape').textContent = stats.last_scrape 
                    ? formatDate(stats.last_scrape.completed_at || stats.last_scrape.started_at)
                    : 'Never';

                // Country chart
                const countryChart = document.getElementById('country-chart');
                const maxCountry = Math.max(...stats.by_country.map(c => c.count), 1);
                countryChart.innerHTML = stats.by_country.slice(0, 5).map(c => `
                    <div class="flex items-center">
                        <span class="w-20 text-sm text-gray-600">${c.country || 'Unknown'}</span>
                        <div class="flex-1 bg-gray-200 rounded-full h-4 mx-3">
                            <div class="bg-purple-600 h-4 rounded-full" style="width: ${(c.count / maxCountry * 100)}%"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-900">${c.count}</span>
                    </div>
                `).join('') || '<p class="text-gray-500 text-sm">No data yet</p>';

                // Language chart
                const languageChart = document.getElementById('language-chart');
                const maxLang = Math.max(...stats.by_language.map(l => l.count), 1);
                languageChart.innerHTML = stats.by_language.map(l => `
                    <div class="flex items-center">
                        <span class="w-20 text-sm text-gray-600 capitalize">${l.language}</span>
                        <div class="flex-1 bg-gray-200 rounded-full h-4 mx-3">
                            <div class="bg-blue-600 h-4 rounded-full" style="width: ${(l.count / maxLang * 100)}%"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-900">${l.count}</span>
                    </div>
                `).join('') || '<p class="text-gray-500 text-sm">No data yet</p>';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Channels
        async function loadChannels() {
            const { search, country, language, minSubs, maxSubs } = getFilterParams();
            try {
                const params = new URLSearchParams({
                    limit: pageSize,
                    offset: currentPage * pageSize,
                    search: search,
                    country: country,
                    language: language,
                    min_subs: minSubs,
                    max_subs: maxSubs
                });
                
                const response = await fetch(`/api/channels?${params}`);
                const data = await response.json();
                
                // Update filter count
                document.getElementById('filter-count').textContent = `Showing ${data.channels.length} of ${data.total} channels`;

                const grid = document.getElementById('channels-grid');
                if (data.channels.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">No channels found</h3>
                            <p class="mt-1 text-sm text-gray-500">Run the scraper to discover YouTube channels.</p>
                        </div>
                    `;
                } else {
                    grid.innerHTML = data.channels.map(channel => `
                        <div class="bg-white rounded-xl shadow-sm p-5 card-hover transition-all fade-in">
                            <div class="flex items-start space-x-4">
                                <img src="${channel.thumbnail_url || 'https://via.placeholder.com/80'}" 
                                    alt="${channel.channel_title}" 
                                    class="w-16 h-16 rounded-full object-cover">
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-900 truncate">${channel.channel_title}</h3>
                                    <p class="text-xs text-gray-500 mt-1">${channel.country || 'Unknown'} â€¢ ${channel.detected_language || 'Unknown'}</p>
                                </div>
                                <button onclick="deleteChannel('${channel.channel_id}')" 
                                    class="text-gray-400 hover:text-red-500 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 mt-3 line-clamp-2">${channel.description?.substring(0, 100) || 'No description'}...</p>
<div class="flex items-center justify-between mt-4 pt-4 border-t">
                                                <div class="flex space-x-4 text-xs text-gray-500">
                                                    <span><strong class="text-gray-900">${formatNumber(channel.subscribers || 0)}</strong> subs</span>
                                                    <span><strong class="text-gray-900">${formatNumber(channel.video_count || 0)}</strong> videos</span>
                                                </div>
                                                <div class="flex space-x-2">
                                                    <button onclick="showOutreachModal('${channel.channel_id}', '${channel.channel_title.replace(/'/g, "\\'")}', ${channel.subscribers || 0})"
                                                        class="bg-green-100 text-green-700 hover:bg-green-200 px-2 py-1 rounded text-xs font-medium">
                                                        ğŸ“§ Outreach
                                                    </button>
                                                    <a href="${channel.channel_url}" target="_blank" 
                                                        class="text-purple-600 hover:text-purple-800 text-xs font-medium">
                                                        View â†’
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('');
                }

                // Pagination
                const totalPages = Math.ceil(data.total / pageSize);
                const pagination = document.getElementById('pagination');
                if (totalPages > 1) {
                    pagination.innerHTML = `
                        <button onclick="changePage(-1)" ${currentPage === 0 ? 'disabled' : ''} 
                            class="px-3 py-2 rounded-lg bg-white border ${currentPage === 0 ? 'text-gray-300' : 'text-gray-700 hover:bg-gray-50'}">
                            Previous
                        </button>
                        <span class="text-sm text-gray-600">Page ${currentPage + 1} of ${totalPages}</span>
                        <button onclick="changePage(1)" ${currentPage >= totalPages - 1 ? 'disabled' : ''} 
                            class="px-3 py-2 rounded-lg bg-white border ${currentPage >= totalPages - 1 ? 'text-gray-300' : 'text-gray-700 hover:bg-gray-50'}">
                            Next
                        </button>
                    `;
                } else {
                    pagination.innerHTML = '';
                }
            } catch (error) {
                console.error('Error loading channels:', error);
            }
        }

        function changePage(delta) {
            currentPage += delta;
            loadChannels();
        }

        async function deleteChannel(channelId) {
            if (!confirm('Are you sure you want to delete this channel?')) return;
            try {
                await fetch(`/api/channels/${channelId}`, { method: 'DELETE' });
                showToast('Channel deleted');
                loadChannels();
                loadStats();
            } catch (error) {
                showToast('Error deleting channel', 'error');
            }
        }

        async function exportChannels() {
            try {
                const response = await fetch('/api/export?format=csv');
                const data = await response.json();
                
                const blob = new Blob([data.csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `youtube_channels_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                
                showToast(`Exported ${data.count} channels`);
            } catch (error) {
                showToast('Error exporting channels', 'error');
            }
        }

        // Queries
        async function loadQueries() {
            try {
                const response = await fetch('/api/queries');
                const queries = await response.json();

                const list = document.getElementById('queries-list');
                if (queries.length === 0) {
                    list.innerHTML = '<p class="p-6 text-gray-500 text-center">No search queries configured</p>';
                } else {
                    list.innerHTML = `
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Query</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Max Results</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Region</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${queries.map(q => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${q.query}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${q.max_results}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${q.region_code}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <button onclick="toggleQuery(${q.id}, ${!q.is_active})" 
                                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                                ${q.is_active ? 'Active' : 'Inactive'}
                                            </button>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                                            <button onclick="deleteQuery(${q.id})" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                console.error('Error loading queries:', error);
            }
        }

        function showAddQueryModal() {
            document.getElementById('query-modal').classList.remove('hidden');
            document.getElementById('query-modal').classList.add('flex');
        }

        function hideQueryModal() {
            document.getElementById('query-modal').classList.add('hidden');
            document.getElementById('query-modal').classList.remove('flex');
            document.getElementById('query-form').reset();
        }
        
        // Bulk Query Modal
        function showBulkQueryModal() {
            document.getElementById('bulk-query-modal').classList.remove('hidden');
            document.getElementById('bulk-query-modal').classList.add('flex');
            updateBulkQueryCount();
        }
        
        function hideBulkQueryModal() {
            document.getElementById('bulk-query-modal').classList.add('hidden');
            document.getElementById('bulk-query-modal').classList.remove('flex');
        }
        
        function updateBulkQueryCount() {
            const text = document.getElementById('bulk-queries-input').value;
            const lines = text.split('\n').filter(l => l.trim());
            document.getElementById('bulk-query-count').textContent = `${lines.length} queries`;
        }
        
        function addExampleQuery(query) {
            const textarea = document.getElementById('bulk-queries-input');
            if (textarea.value && !textarea.value.endsWith('\n')) {
                textarea.value += '\n';
            }
            textarea.value += query;
            updateBulkQueryCount();
        }
        
        async function saveBulkQueries() {
            const queries = document.getElementById('bulk-queries-input').value;
            const maxResults = parseInt(document.getElementById('bulk-max-results').value);
            const regionCode = document.getElementById('bulk-region').value;
            const clearExisting = document.getElementById('bulk-clear-existing').checked;
            
            if (!queries.trim()) {
                showToast('Please enter at least one query', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/queries/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        queries: queries,
                        max_results: maxResults,
                        region_code: regionCode,
                        clear_existing: clearExisting
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message);
                    hideBulkQueryModal();
                    loadQueries();
                    loadStats();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('Error uploading queries', 'error');
            }
        }
        
        async function resetQueries() {
            if (!confirm('Reset all queries to creator-focused defaults?')) return;
            
            try {
                const response = await fetch('/api/queries/reset', { method: 'POST' });
                const result = await response.json();
                showToast(result.message);
                loadQueries();
                loadStats();
            } catch (error) {
                showToast('Error resetting queries', 'error');
            }
        }
        
        async function clearAllQueries() {
            if (!confirm('Are you sure you want to delete ALL search queries?')) return;
            
            try {
                const response = await fetch('/api/queries', { method: 'DELETE' });
                const result = await response.json();
                showToast(result.message);
                loadQueries();
                loadStats();
            } catch (error) {
                showToast('Error clearing queries', 'error');
            }
        }
        
        // Add event listener for bulk query textarea
        document.addEventListener('DOMContentLoaded', () => {
            const bulkTextarea = document.getElementById('bulk-queries-input');
            if (bulkTextarea) {
                bulkTextarea.addEventListener('input', updateBulkQueryCount);
            }
        });

        async function saveQuery(event) {
            event.preventDefault();
            try {
                await fetch('/api/queries', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: document.getElementById('query-input').value,
                        max_results: parseInt(document.getElementById('max-results-input').value),
                        region_code: document.getElementById('region-input').value
                    })
                });
                hideQueryModal();
                showToast('Query added');
                loadQueries();
                loadStats();
            } catch (error) {
                showToast('Error adding query', 'error');
            }
        }

        async function toggleQuery(id, isActive) {
            try {
                await fetch(`/api/queries/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_active: isActive })
                });
                loadQueries();
            } catch (error) {
                showToast('Error updating query', 'error');
            }
        }

        async function deleteQuery(id) {
            if (!confirm('Are you sure you want to delete this query?')) return;
            try {
                await fetch(`/api/queries/${id}`, { method: 'DELETE' });
                showToast('Query deleted');
                loadQueries();
                loadStats();
            } catch (error) {
                showToast('Error deleting query', 'error');
            }
        }

        // History
        async function loadHistory() {
            try {
                const response = await fetch('/api/history');
                const history = await response.json();

                const list = document.getElementById('history-list');
                if (history.length === 0) {
                    list.innerHTML = '<p class="p-6 text-gray-500 text-center">No scrape history yet</p>';
                } else {
                    list.innerHTML = `
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Started</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completed</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Found</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Added</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${history.map(h => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(h.started_at)}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(h.completed_at)}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${h.channels_found}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${h.channels_added}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                h.status === 'completed' ? 'bg-green-100 text-green-800' :
                                                h.status === 'running' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }">
                                                ${h.status}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        // Scraper
        async function triggerScrape() {
            const btn = document.getElementById('scrape-btn');
            const confirmBtn = document.getElementById('confirm-scrape-btn');
            const status = document.getElementById('scraper-status');
            const clearPrevious = document.getElementById('clear-previous').checked;
            const filters = getScrapeFilters();
            
            // Validate at least one country selected
            if (filters.countries.length === 0) {
                showToast('Please select at least one country', 'error');
                return;
            }
            
            // Hide modal
            hideScrapeModal();
            
            btn.disabled = true;
            confirmBtn.disabled = true;
            btn.innerHTML = `
                <svg class="w-4 h-4 mr-2 spinner" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Running...
            `;
            status.innerHTML = '<span class="w-2 h-2 rounded-full bg-yellow-400 mr-2 pulse-dot"></span><span>Scraping...</span>';

            try {
                const response = await fetch('/api/scrape', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        clear_previous: clearPrevious,
                        countries: filters.countries,
                        languages: filters.languages,
                        min_subscribers: filters.minSubs
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    showToast(result.message);
                } else {
                    showToast(result.message, 'error');
                }
                
                // Refresh data
                loadStats();
                if (!document.getElementById('content-channels').classList.contains('hidden')) {
                    loadChannels();
                }
                if (!document.getElementById('content-history').classList.contains('hidden')) {
                    loadHistory();
                }
            } catch (error) {
                showToast('Error running scraper', 'error');
            } finally {
                btn.disabled = false;
                confirmBtn.disabled = false;
                btn.innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Run Scraper
                `;
                status.innerHTML = '<span class="w-2 h-2 rounded-full bg-green-400 mr-2"></span><span>Ready</span>';
            }
        }

        // ============================================================
        // CAMPAIGNS FUNCTIONS
        // ============================================================
        
        async function loadCampaigns() {
            try {
                const response = await fetch('/api/campaigns');
                const data = await response.json();
                
                // Load stats
                const statsRes = await fetch('/api/outreach/stats');
                const stats = await statsRes.json();
                
                document.getElementById('outreach-total').textContent = stats.total_outreach || 0;
                document.getElementById('outreach-drafts').textContent = stats.drafts || 0;
                document.getElementById('outreach-sent').textContent = stats.sent || 0;
                document.getElementById('outreach-replied').textContent = stats.replied || 0;
                document.getElementById('outreach-deals').textContent = stats.deals_closed || 0;
                
                const list = document.getElementById('campaigns-list');
                if (data.campaigns.length === 0) {
                    list.innerHTML = `
                        <div class="bg-white rounded-xl shadow-sm p-8 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">No campaigns yet</h3>
                            <p class="mt-1 text-sm text-gray-500">Create a campaign to start reaching out to creators.</p>
                        </div>
                    `;
                } else {
                    // Load contacts for each campaign
                    const campaignsWithContacts = await Promise.all(data.campaigns.map(async (c) => {
                        const contactsRes = await fetch(`/api/mailing-list?campaign_id=${c.id}`);
                        const contactsData = await contactsRes.json();
                        return { ...c, contacts: contactsData.contacts || [] };
                    }));
                    
                    list.innerHTML = campaignsWithContacts.map(c => `
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden card-hover transition-all">
                            <div class="p-5">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-lg">${c.name}</h3>
                                        <p class="text-sm text-gray-500 mt-1">${c.topic || 'No topic'} â€¢ Budget: $${c.budget_min || 0} - $${c.budget_max || 0}</p>
                                        <p class="text-xs text-green-600 mt-0.5">ğŸ¯ Max Negotiation Offer: $${c.max_offer || 500} (+$50 per round)</p>
                                    </div>
                                    <span class="px-2 py-1 text-xs rounded-full ${c.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">${c.status}</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-3">${c.brief ? c.brief.substring(0, 150) + '...' : 'No brief'}</p>
                                
                                <!-- Creator Contacts Section -->
                                <div class="mt-4 pt-4 border-t">
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium text-gray-700">
                                            <span class="text-purple-600">${c.contacts.length}</span> Creator${c.contacts.length !== 1 ? 's' : ''} Added
                                        </h4>
                                        <button onclick="showAddCreatorsToCampaign(${c.id}, '${c.name.replace(/'/g, "\\'")}')" 
                                            class="text-sm text-purple-600 hover:text-purple-800 flex items-center">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Add Creators
                                        </button>
                                    </div>
                                    
                                    ${c.contacts.length > 0 ? `
                                        <div class="space-y-2 max-h-40 overflow-y-auto">
                                            ${c.contacts.slice(0, 5).map(contact => `
                                                <div class="flex justify-between items-center bg-gray-50 rounded-lg px-3 py-2 text-sm">
                                                    <div>
                                                        <span class="font-medium text-gray-900">${contact.name}</span>
                                                        <span class="text-gray-500 ml-2">${contact.email}</span>
                                                    </div>
                                                    <span class="px-2 py-0.5 text-xs rounded-full ${
                                                        contact.status === 'sent' ? 'bg-green-100 text-green-800' :
                                                        contact.status === 'replied' ? 'bg-blue-100 text-blue-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">${contact.status}</span>
                                                </div>
                                            `).join('')}
                                            ${c.contacts.length > 5 ? `
                                                <p class="text-xs text-gray-500 text-center">+ ${c.contacts.length - 5} more creators</p>
                                            ` : ''}
                                        </div>
                                    ` : `
                                        <p class="text-sm text-gray-400 text-center py-4">No creators added yet. Click "Add Creators" to add emails.</p>
                                    `}
                                </div>
                            </div>
                            
                            <!-- Campaign Actions Footer -->
                            <div class="bg-gray-50 px-5 py-3 flex justify-between items-center">
                                <span class="text-xs text-gray-500">Created: ${formatDate(c.created_at)}</span>
                                <div class="flex space-x-3">
                                    <button onclick="viewCampaignDetails(${c.id})" class="text-gray-600 hover:text-gray-800 text-sm">View Conversations</button>
                                    <button onclick="deleteCampaign(${c.id})" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                                    ${c.contacts.filter(x => x.status === 'pending').length > 0 ? `
                                        <button onclick="startCampaign(${c.id})" 
                                            class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:from-purple-700 hover:to-blue-700 transition-all flex items-center">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            Start Campaign (${c.contacts.filter(x => x.status === 'pending').length})
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading campaigns:', error);
            }
        }
        
        let currentCampaignIdForCreators = null;
        
        function showAddCreatorsToCampaign(campaignId, campaignName) {
            currentCampaignIdForCreators = campaignId;
            document.getElementById('add-creators-campaign-name').textContent = campaignName;
            document.getElementById('add-creators-modal').classList.remove('hidden');
            document.getElementById('add-creators-modal').classList.add('flex');
        }
        
        function hideAddCreatorsModal() {
            document.getElementById('add-creators-modal').classList.add('hidden');
            document.getElementById('add-creators-modal').classList.remove('flex');
            document.getElementById('campaign-creators-input').value = '';
            currentCampaignIdForCreators = null;
        }
        
        async function addCreatorsToCampaign() {
            const text = document.getElementById('campaign-creators-input').value;
            
            if (!text.trim()) {
                showToast('Please enter creator contacts', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/mailing-list/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contacts_text: text,
                        campaign_id: currentCampaignIdForCreators
                    })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast(`Added ${result.added} creators to campaign!`);
                    hideAddCreatorsModal();
                    loadCampaigns();
                } else {
                    showToast('Error adding creators', 'error');
                }
            } catch (error) {
                showToast('Error adding creators', 'error');
            }
        }
        
        async function startCampaign(campaignId) {
            if (!confirm('This will send AI-generated emails to all pending creators in this campaign. Continue?')) {
                return;
            }
            
            showToast('Starting campaign... Sending emails...', 'info');
            
            try {
                const response = await fetch('/api/mailing-list/send-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: campaignId })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast(`Campaign started! Sent ${result.sent} of ${result.total} emails`);
                    // Small delay then refresh to ensure DB is updated
                    setTimeout(() => loadCampaigns(), 500);
                } else {
                    showToast(result.detail || 'Error starting campaign', 'error');
                }
            } catch (error) {
                showToast('Error starting campaign', 'error');
            }
        }
        
        // View Campaign Details with Conversations
        async function viewCampaignDetails(campaignId) {
            try {
                // Get campaign info
                const campRes = await fetch(`/api/campaigns/${campaignId}`);
                const campaign = await campRes.json();
                
                // Get outreach emails for this campaign
                const outreachRes = await fetch(`/api/outreach?campaign_id=${campaignId}`);
                const outreachData = await outreachRes.json();
                
                document.getElementById('campaign-detail-name').textContent = campaign.name;
                document.getElementById('campaign-detail-brief').textContent = campaign.brief || 'No brief';
                
                const outreachList = document.getElementById('campaign-outreach-list');
                
                if (outreachData.outreach.length === 0) {
                    outreachList.innerHTML = '<p class="text-gray-500 text-center py-8">No emails sent yet. Add creators and start the campaign.</p>';
                } else {
                    outreachList.innerHTML = outreachData.outreach.map(o => `
                        <div class="border rounded-lg p-4 mb-4 ${o.status === 'replied' ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <span class="font-medium text-gray-900">${o.recipient_email}</span>
                                    <span class="ml-2 px-2 py-0.5 text-xs rounded-full ${
                                        o.status === 'sent' ? 'bg-blue-100 text-blue-800' :
                                        o.status === 'replied' ? 'bg-green-100 text-green-800' :
                                        'bg-gray-100 text-gray-800'
                                    }">${o.status}</span>
                                </div>
                                <span class="text-xs text-gray-500">${formatDate(o.sent_at || o.created_at)}</span>
                            </div>
                            
                            <div class="text-sm text-gray-700 mb-2">
                                <strong>Subject:</strong> ${o.subject}
                            </div>
                            
                            <details class="text-sm">
                                <summary class="cursor-pointer text-purple-600 hover:text-purple-800">View Email Content</summary>
                                <div class="mt-2 p-3 bg-white rounded border text-gray-600 whitespace-pre-wrap">${o.body}</div>
                            </details>
                            
                            ${o.reply_content ? `
                                <div class="mt-3 p-3 bg-green-100 rounded-lg">
                                    <p class="text-xs text-green-800 font-medium mb-1">Creator's Reply:</p>
                                    <p class="text-sm text-green-900">${o.reply_content}</p>
                                </div>
                            ` : ''}
                            
                            ${o.ai_response ? `
                                <div class="mt-2 p-3 bg-purple-50 rounded-lg">
                                    <p class="text-xs text-purple-800 font-medium mb-1">AI Follow-up Sent:</p>
                                    <p class="text-sm text-purple-900">${o.ai_response}</p>
                                </div>
                            ` : ''}
                            
                            <div class="mt-3 flex space-x-2">
                                <button onclick="showReplyInput(${o.id})" 
                                    class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
                                    Log Creator Reply
                                </button>
                                ${o.reply_content && !o.ai_response ? `
                                    <button onclick="generateAIResponse(${o.id})" 
                                        class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                                        Generate AI Response
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `).join('');
                }
                
                document.getElementById('campaign-detail-modal').classList.remove('hidden');
                document.getElementById('campaign-detail-modal').classList.add('flex');
                
            } catch (error) {
                console.error('Error loading campaign details:', error);
                showToast('Error loading campaign details', 'error');
            }
        }
        
        function hideCampaignDetailModal() {
            document.getElementById('campaign-detail-modal').classList.add('hidden');
            document.getElementById('campaign-detail-modal').classList.remove('flex');
        }
        
        let currentReplyOutreachId = null;
        
        function showReplyInput(outreachId) {
            currentReplyOutreachId = outreachId;
            document.getElementById('reply-input-modal').classList.remove('hidden');
            document.getElementById('reply-input-modal').classList.add('flex');
        }
        
        function hideReplyInputModal() {
            document.getElementById('reply-input-modal').classList.add('hidden');
            document.getElementById('reply-input-modal').classList.remove('flex');
            document.getElementById('creator-reply-text').value = '';
            currentReplyOutreachId = null;
        }
        
        async function saveCreatorReply() {
            const replyText = document.getElementById('creator-reply-text').value;
            
            if (!replyText.trim()) {
                showToast('Please enter the reply content', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/outreach/${currentReplyOutreachId}/reply`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reply_content: replyText })
                });
                
                if (response.ok) {
                    showToast('Reply logged successfully!');
                    hideReplyInputModal();
                    // Refresh the campaign details
                    const modal = document.getElementById('campaign-detail-modal');
                    if (!modal.classList.contains('hidden')) {
                        // Get campaign ID from somewhere and refresh
                        loadCampaigns();
                    }
                } else {
                    showToast('Error saving reply', 'error');
                }
            } catch (error) {
                showToast('Error saving reply', 'error');
            }
        }
        
        async function generateAIResponse(outreachId) {
            showToast('Generating AI response...', 'info');
            
            try {
                const response = await fetch(`/api/outreach/${outreachId}/negotiate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast('AI response generated and sent!');
                    loadCampaigns();
                } else {
                    showToast(result.detail || 'Error generating response', 'error');
                }
            } catch (error) {
                showToast('Error generating AI response', 'error');
            }
        }
        
        async function runAutoNegotiatorNow() {
            showToast('Checking inbox for replies...', 'info');
            
            try {
                const response = await fetch('/api/auto-negotiator/run', {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (response.ok) {
                    if (result.processed > 0) {
                        showToast(`Processed ${result.processed} new replies!`);
                        loadCampaigns();
                    } else {
                        showToast('No new replies found');
                    }
                } else {
                    showToast(result.detail || 'Error checking inbox', 'error');
                }
            } catch (error) {
                showToast('Error running auto-negotiator', 'error');
            }
        }
        
        function showCampaignModal() {
            document.getElementById('campaign-modal').classList.remove('hidden');
            document.getElementById('campaign-modal').classList.add('flex');
        }
        
        function hideCampaignModal() {
            document.getElementById('campaign-modal').classList.add('hidden');
            document.getElementById('campaign-modal').classList.remove('flex');
            document.getElementById('campaign-form').reset();
        }
        
        async function saveCampaign(event) {
            event.preventDefault();
            try {
                const response = await fetch('/api/campaigns', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('campaign-name').value,
                        brief: document.getElementById('campaign-brief').value,
                        topic: document.getElementById('campaign-topic').value,
                        budget_min: parseFloat(document.getElementById('campaign-budget-min').value) || 0,
                        budget_max: parseFloat(document.getElementById('campaign-budget-max').value) || 0,
                        max_offer: parseFloat(document.getElementById('campaign-max-offer').value) || 500,
                        offer_increment: 50,
                        requirements: document.getElementById('campaign-requirements').value,
                        deadline: document.getElementById('campaign-deadline').value
                    })
                });
                if (response.ok) {
                    showToast('Campaign created');
                    hideCampaignModal();
                    loadCampaigns();
                } else {
                    showToast('Error creating campaign', 'error');
                }
            } catch (error) {
                showToast('Error creating campaign', 'error');
            }
        }
        
        async function deleteCampaign(id) {
            if (!confirm('Delete this campaign?')) return;
            try {
                await fetch(`/api/campaigns/${id}`, { method: 'DELETE' });
                showToast('Campaign deleted');
                loadCampaigns();
            } catch (error) {
                showToast('Error deleting campaign', 'error');
            }
        }
        
        async function viewCampaign(id) {
            // TODO: Show campaign detail view
            showToast('Campaign detail view coming soon');
        }
        
        // ============================================================
        // EMAIL ACCOUNTS FUNCTIONS
        // ============================================================
        
        async function loadEmailAccounts() {
            try {
                const response = await fetch('/api/email-accounts');
                const data = await response.json();
                
                const list = document.getElementById('email-accounts-list');
                if (data.accounts.length === 0) {
                    list.innerHTML = '<p class="p-6 text-gray-500 text-center">No email accounts configured. Add one to start sending outreach.</p>';
                } else {
                    list.innerHTML = `
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Display Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Sent Today</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Limit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${data.accounts.map(a => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${a.email}</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">${a.display_name || '-'}</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">${a.emails_sent_today || 0}</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">${a.daily_limit}/day</td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 text-xs rounded-full ${a.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                ${a.is_active ? 'Active' : 'Inactive'}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 text-right text-sm space-x-2">
                                            <button onclick="testEmailAccount(${a.id})" class="text-blue-600 hover:text-blue-800">Test</button>
                                            <button onclick="deleteEmailAccount(${a.id})" class="text-red-600 hover:text-red-800">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                console.error('Error loading email accounts:', error);
            }
        }
        
        function showEmailAccountModal() {
            document.getElementById('email-account-modal').classList.remove('hidden');
            document.getElementById('email-account-modal').classList.add('flex');
            selectEmailProvider('gmail'); // Default to Gmail
        }
        
        function hideEmailAccountModal() {
            document.getElementById('email-account-modal').classList.add('hidden');
            document.getElementById('email-account-modal').classList.remove('flex');
            document.getElementById('email-account-form').reset();
        }
        
        function selectEmailProvider(provider) {
            // Update button styles
            ['gmail', 'sendgrid', 'custom'].forEach(p => {
                const btn = document.getElementById(`provider-${p}`);
                if (p === provider) {
                    btn.classList.add('border-purple-500', 'bg-purple-50', 'text-purple-700');
                    btn.classList.remove('border-gray-200', 'text-gray-600');
                } else {
                    btn.classList.remove('border-purple-500', 'bg-purple-50', 'text-purple-700');
                    btn.classList.add('border-gray-200', 'text-gray-600');
                }
            });
            
            // Update hidden field
            document.getElementById('email-provider').value = provider;
            
            // Show/hide instructions and fields
            document.getElementById('gmail-instructions').classList.toggle('hidden', provider !== 'gmail');
            document.getElementById('sendgrid-instructions').classList.toggle('hidden', provider !== 'sendgrid');
            document.getElementById('custom-smtp-fields').classList.toggle('hidden', provider !== 'custom');
            
            // Update password label
            const passwordLabel = document.getElementById('password-label');
            if (provider === 'gmail') {
                passwordLabel.textContent = 'App Password*';
                document.getElementById('email-password').placeholder = '16-character App Password';
            } else if (provider === 'sendgrid') {
                passwordLabel.textContent = 'SendGrid API Key*';
                document.getElementById('email-password').placeholder = 'SG.xxxxxx...';
            } else {
                passwordLabel.textContent = 'Password*';
                document.getElementById('email-password').placeholder = 'SMTP Password';
            }
        }
        
        function showBulkEmailModal() {
            document.getElementById('bulk-email-modal').classList.remove('hidden');
            document.getElementById('bulk-email-modal').classList.add('flex');
        }
        
        function hideBulkEmailModal() {
            document.getElementById('bulk-email-modal').classList.add('hidden');
            document.getElementById('bulk-email-modal').classList.remove('flex');
        }
        
        async function saveEmailAccount(event) {
            if (event) event.preventDefault();
            
            console.log('saveEmailAccount called');
            
            const provider = document.getElementById('email-provider')?.value || 'gmail';
            const email = document.getElementById('email-address')?.value || '';
            const password = document.getElementById('email-password')?.value || '';
            const displayName = document.getElementById('email-display-name')?.value || '';
            const dailyLimit = parseInt(document.getElementById('email-daily-limit')?.value) || 100;
            const skipTestEl = document.getElementById('skip-test');
            const skipTest = skipTestEl ? skipTestEl.checked : false;
            
            console.log('Form values:', { provider, email, displayName, dailyLimit, skipTest });
            
            if (!email) {
                showToast('Please enter an email address', 'error');
                return;
            }
            if (!password) {
                showToast('Please enter a password', 'error');
                return;
            }
            
            let smtpHost, smtpPort, smtpUser;
            
            if (provider === 'gmail') {
                smtpHost = 'smtp.gmail.com';
                smtpPort = 587;
                smtpUser = email;
            } else if (provider === 'sendgrid') {
                smtpHost = 'smtp.sendgrid.net';
                smtpPort = 587;
                smtpUser = 'apikey';
            } else {
                smtpHost = document.getElementById('smtp-host')?.value || '';
                smtpPort = parseInt(document.getElementById('smtp-port')?.value) || 587;
                smtpUser = document.getElementById('smtp-user')?.value || email;
                
                if (!smtpHost) {
                    showToast('Please enter SMTP host', 'error');
                    return;
                }
            }
            
            // Show loading state
            showToast('Adding email account...', 'info');
            
            try {
                console.log('Sending request to /api/email-accounts');
                const response = await fetch('/api/email-accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        smtp_host: smtpHost,
                        smtp_port: smtpPort,
                        smtp_user: smtpUser,
                        smtp_password: password,
                        display_name: displayName,
                        daily_limit: dailyLimit,
                        skip_test: skipTest
                    })
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response body:', result);
                
                if (response.ok) {
                    showToast('Email account added successfully!');
                    hideEmailAccountModal();
                    loadEmailAccounts();
                } else {
                    showToast(result.detail || 'Error adding account', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error adding account: ' + error.message, 'error');
            }
        }
        
        async function saveBulkEmails() {
            const text = document.getElementById('bulk-emails-input').value;
            if (!text.trim()) {
                showToast('Please enter email accounts', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/email-accounts/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accounts_text: text })
                });
                
                const result = await response.json();
                showToast(`Added ${result.added} accounts, ${result.failed} failed`);
                hideBulkEmailModal();
                loadEmailAccounts();
            } catch (error) {
                showToast('Error adding accounts', 'error');
            }
        }
        
        async function testEmailAccount(id) {
            showToast('Testing connection...');
            try {
                const response = await fetch(`/api/email-accounts/${id}/test`, { method: 'POST' });
                const result = await response.json();
                showToast(result.message, result.success ? 'success' : 'error');
            } catch (error) {
                showToast('Test failed', 'error');
            }
        }
        
        async function deleteEmailAccount(id) {
            if (!confirm('Delete this email account?')) return;
            try {
                await fetch(`/api/email-accounts/${id}`, { method: 'DELETE' });
                showToast('Account deleted');
                loadEmailAccounts();
            } catch (error) {
                showToast('Error deleting account', 'error');
            }
        }
        
        // ============================================================
        // OUTREACH FUNCTIONS
        // ============================================================
        
        let currentOutreachChannelId = null;
        let currentOutreachId = null;
        
        async function showOutreachModal(channelId, channelTitle, subscribers) {
            currentOutreachChannelId = channelId;
            document.getElementById('outreach-creator-name').textContent = channelTitle;
            document.getElementById('outreach-creator-subs').textContent = `${formatNumber(subscribers)} subscribers`;
            document.getElementById('generated-email-preview').classList.add('hidden');
            
            // Load campaigns dropdown
            const campaignsRes = await fetch('/api/campaigns');
            const campaignsData = await campaignsRes.json();
            const campaignSelect = document.getElementById('outreach-campaign');
            campaignSelect.innerHTML = '<option value="">-- Select Campaign --</option>' +
                campaignsData.campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            // Load email accounts dropdown
            const emailsRes = await fetch('/api/email-accounts');
            const emailsData = await emailsRes.json();
            const emailSelect = document.getElementById('outreach-email-account');
            emailSelect.innerHTML = '<option value="">-- Select Email Account --</option>' +
                emailsData.accounts.filter(a => a.is_active).map(a => `<option value="${a.id}">${a.email}</option>`).join('');
            
            document.getElementById('outreach-modal').classList.remove('hidden');
            document.getElementById('outreach-modal').classList.add('flex');
        }
        
        function hideOutreachModal() {
            document.getElementById('outreach-modal').classList.add('hidden');
            document.getElementById('outreach-modal').classList.remove('flex');
            currentOutreachChannelId = null;
            currentOutreachId = null;
        }
        
        async function generateOutreachPreview() {
            const campaignId = document.getElementById('outreach-campaign').value;
            const emailAccountId = document.getElementById('outreach-email-account').value;
            const recipientEmail = document.getElementById('outreach-recipient-email').value;
            
            if (!campaignId || !emailAccountId || !recipientEmail) {
                showToast('Please fill all fields first', 'error');
                return;
            }
            
            showToast('Generating email with AI...');
            
            try {
                const response = await fetch('/api/outreach/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        campaign_id: parseInt(campaignId),
                        channel_id: currentOutreachChannelId,
                        recipient_email: recipientEmail,
                        email_account_id: parseInt(emailAccountId)
                    })
                });
                
                const result = await response.json();
                if (response.ok) {
                    currentOutreachId = result.outreach_id;
                    document.getElementById('preview-subject').textContent = result.email.subject;
                    document.getElementById('preview-body').textContent = result.email.body;
                    document.getElementById('generated-email-preview').classList.remove('hidden');
                    showToast('Email generated!');
                } else {
                    showToast(result.detail || 'Error generating email', 'error');
                }
            } catch (error) {
                showToast('Error generating email', 'error');
            }
        }
        
        async function sendOutreachEmail() {
            if (!currentOutreachId) {
                showToast('Please generate the email first', 'error');
                return;
            }
            
            const btn = document.getElementById('send-outreach-btn');
            btn.disabled = true;
            btn.textContent = 'Sending...';
            
            try {
                const response = await fetch(`/api/outreach/${currentOutreachId}/send`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast('Email sent successfully!');
                    hideOutreachModal();
                    loadCampaigns();
                } else {
                    showToast(result.detail || 'Failed to send', 'error');
                }
            } catch (error) {
                showToast('Error sending email', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>Send Email';
            }
        }

        // ============================================================
        // MAILING LIST FUNCTIONS
        // ============================================================
        
        async function loadMailingList() {
            try {
                const response = await fetch('/api/mailing-list');
                const data = await response.json();
                
                // Update stats
                document.getElementById('ml-stat-total').textContent = data.stats.total || 0;
                document.getElementById('ml-stat-pending').textContent = data.stats.pending || 0;
                document.getElementById('ml-stat-sent').textContent = data.stats.sent || 0;
                document.getElementById('ml-stat-replied').textContent = data.stats.replied || 0;
                
                // Update campaign dropdown
                await loadCampaignsForMailingList();
                
                const tbody = document.getElementById('mailing-list-body');
                const emptyState = document.getElementById('mailing-list-empty');
                
                if (data.contacts.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                tbody.innerHTML = data.contacts.map(contact => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${contact.name}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${contact.email}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">${contact.channel_title || '-'}</div>
                            ${contact.subscribers ? `<div class="text-xs text-gray-400">${formatNumber(contact.subscribers)} subs</div>` : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                contact.status === 'sent' ? 'bg-green-100 text-green-800' :
                                contact.status === 'replied' ? 'bg-blue-100 text-blue-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">
                                ${contact.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <button onclick="deleteMailingListContact(${contact.id})" 
                                class="text-red-600 hover:text-red-800">Remove</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading mailing list:', error);
            }
        }
        
        async function loadCampaignsForMailingList() {
            try {
                const response = await fetch('/api/campaigns');
                const data = await response.json();
                
                const select = document.getElementById('ml-campaign-select');
                select.innerHTML = '<option value="">-- Select a Campaign --</option>' +
                    data.campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            } catch (error) {
                console.error('Error loading campaigns:', error);
            }
        }
        
        function showAddContactModal() {
            document.getElementById('add-contact-modal').classList.remove('hidden');
            document.getElementById('add-contact-modal').classList.add('flex');
        }
        
        function hideAddContactModal() {
            document.getElementById('add-contact-modal').classList.add('hidden');
            document.getElementById('add-contact-modal').classList.remove('flex');
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-email').value = '';
            document.getElementById('contact-notes').value = '';
            document.getElementById('bulk-contacts-input').value = '';
        }
        
        async function addSingleContact() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const notes = document.getElementById('contact-notes').value;
            
            if (!name || !email) {
                showToast('Please enter name and email', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/mailing-list', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, notes })
                });
                
                if (response.ok) {
                    showToast('Contact added!');
                    document.getElementById('contact-name').value = '';
                    document.getElementById('contact-email').value = '';
                    document.getElementById('contact-notes').value = '';
                    loadMailingList();
                } else {
                    showToast('Error adding contact', 'error');
                }
            } catch (error) {
                showToast('Error adding contact', 'error');
            }
        }
        
        async function addBulkContacts() {
            const text = document.getElementById('bulk-contacts-input').value;
            
            if (!text.trim()) {
                showToast('Please enter contacts', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/mailing-list/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contacts_text: text })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast(`Added ${result.added} contacts!`);
                    hideAddContactModal();
                    loadMailingList();
                } else {
                    showToast('Error adding contacts', 'error');
                }
            } catch (error) {
                showToast('Error adding contacts', 'error');
            }
        }
        
        async function deleteMailingListContact(contactId) {
            if (!confirm('Remove this contact?')) return;
            
            try {
                const response = await fetch(`/api/mailing-list/${contactId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Contact removed');
                    loadMailingList();
                } else {
                    showToast('Error removing contact', 'error');
                }
            } catch (error) {
                showToast('Error removing contact', 'error');
            }
        }
        
        async function clearMailingList() {
            if (!confirm('Clear all contacts from the mailing list?')) return;
            
            try {
                const response = await fetch('/api/mailing-list', {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Mailing list cleared');
                    loadMailingList();
                } else {
                    showToast('Error clearing list', 'error');
                }
            } catch (error) {
                showToast('Error clearing list', 'error');
            }
        }
        
        async function sendToAllPending() {
            const campaignId = document.getElementById('ml-campaign-select').value;
            
            if (!campaignId) {
                showToast('Please select a campaign first', 'error');
                return;
            }
            
            if (!confirm('Send AI-generated emails to all pending contacts?')) return;
            
            showToast('Sending emails... This may take a moment', 'info');
            
            try {
                const response = await fetch('/api/mailing-list/send-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: parseInt(campaignId) })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showToast(`Sent ${result.sent} of ${result.total} emails!`);
                    loadMailingList();
                } else {
                    showToast(result.detail || 'Error sending emails', 'error');
                }
            } catch (error) {
                showToast('Error sending emails', 'error');
            }
        }

        // Tab switching update
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById(`tab-${tabName}`).classList.add('border-purple-500', 'text-purple-600');
            document.getElementById(`tab-${tabName}`).classList.remove('border-transparent', 'text-gray-500');
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            // Load data for tab
            if (tabName === 'dashboard') loadStats();
            if (tabName === 'channels') loadChannels();
            if (tabName === 'queries') loadQueries();
            if (tabName === 'history') loadHistory();
            if (tabName === 'campaigns') loadCampaigns();
            if (tabName === 'emails') loadEmailAccounts();
            if (tabName === 'mailing') loadMailingList();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadFilterOptions();
        });
    </script>
</body>
</html>
